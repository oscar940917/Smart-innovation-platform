<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¨‹å¼ç¢¼ç”Ÿæˆå·¥å…·</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-c.min.js"></script>

    <style>
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
            background-color: #fff;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-radius: 12px;
        }
        h1 { text-align: center; color: #333; margin-bottom: 30px; }
        label { font-weight: bold; display: block; margin-bottom: 10px; }
        textarea, select {
            width: 100%;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 16px;
            margin-bottom: 15px;
            box-sizing: border-box;
            font-family: Consolas, Monaco, monospace;
        }
        input[type="submit"] {
            padding: 12px 30px;
            border: none;
            background-color: #4CAF50;
            color: white;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        input[type="submit"]:hover { background-color: #45a049; }
        
        /* ç¨‹å¼ç¢¼çµæœå€å¡Šçš„æ¨£å¼ */
        .result {
            margin-top: 30px;
            background-color: #2d2d2d;
            border-radius: 8px;
            padding: 20px;
            color: #f8f8f2;
            font-size: 14px;
            overflow-x: auto;
            position: relative; /* ç‚ºäº†å®šä½è¤‡è£½æŒ‰éˆ• */
        }
        pre { margin: 0; white-space: pre-wrap; word-wrap: break-word; }

        /* æ–°å¢çš„è¤‡è£½æŒ‰éˆ•æ¨£å¼ */
        .copy-button {
            background-color: #555;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
            font-weight: bold;
            display: inline-flex; /* è®“å…§å®¹å°é½Š */
            align-items: center;
            gap: 5px; /* åœ–ç¤ºå’Œæ–‡å­—é–“è· */
        }
        .copy-button:hover {
            background-color: #777;
        }
        .copy-button:active {
            background-color: #444;
        }
        /* è®“æ¨™é¡Œå’ŒæŒ‰éˆ•ä¸¦æ’ */
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* è¼•å¾®åˆ†éš”ç·š */
        }
        .result-header h3 {
            margin: 0;
            color: #61afef; /* ä½¿ç”¨äº®è‰²ç³» */
        }
        
    </style>
</head>
<body>
    <div class="container">
        <h1>ç¨‹å¼ç¢¼ç”Ÿæˆå·¥å…·</h1>

        <form method="POST" action="/">
            <label for="description">è«‹è¼¸å…¥ä½ çš„éœ€æ±‚æè¿°ï¼š</label>
            <textarea id="description" name="description" placeholder="æè¿°ä½ æƒ³ç”Ÿæˆçš„ç¨‹å¼ç¢¼åŠŸèƒ½"></textarea>

            <label for="language">é¸æ“‡ç¨‹å¼èªè¨€ï¼š</label>
            <select id="language" name="language">
                <option value="Python" {% if language=='Python' %}selected{% endif %}>Python</option>
                <option value="JavaScript" {% if language=='JavaScript' %}selected{% endif %}>JavaScript</option>
                <option value="Java" {% if language=='Java' %}selected{% endif %}>Java</option>
                <option value="C" {% if language=='C' %}selected{% endif %}>C</option> 
                </select>

            <input type="submit" value="ç”Ÿæˆç¨‹å¼ç¢¼">
        </form>

        {% if result %}
        <div class="result">
            
            <div class="result-header">
                <h3>ç”Ÿæˆçš„ç¨‹å¼ç¢¼ï¼š</h3>
                <button class="copy-button" onclick="copyCode('generated-code')">
                    <span id="copy-icon">ğŸ“‹</span> è¤‡è£½ç¨‹å¼ç¢¼
                </button>
            </div>
            
            <pre id="generated-code"><code class="language-{{ language|lower }}">{{ result }}</code></pre>

            {% if complexity %}
            <div style="margin-top: 20px;">
                <h3 style="color: #61afef; margin-bottom: 10px; padding-bottom: 0; border-bottom: none;">è¤‡é›œåº¦åˆ†æï¼š</h3>
                <pre>{{ complexity }}</pre>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <script>
        function copyCode(elementId) {
            const preElement = document.getElementById(elementId);
            let codeToCopy = '';
            
            // å˜—è©¦å¾ <code> æ¨™ç±¤ä¸­ç²å–å…§å®¹
            const codeElement = preElement.querySelector('code');
            if (codeElement) {
                codeToCopy = codeElement.textContent;
            } else if (preElement) {
                // å¦‚æœæ²’æœ‰ <code> æ¨™ç±¤ï¼Œç›´æ¥å– <pre> çš„å…§å®¹ (ç”¨æ–¼è¤‡é›œåº¦åˆ†æç­‰)
                codeToCopy = preElement.textContent;
            }

            if (codeToCopy) {
                // ä½¿ç”¨ç¾ä»£çš„ Clipboard API é€²è¡Œè¤‡è£½
                navigator.clipboard.writeText(codeToCopy)
                    .then(() => {
                        const button = document.querySelector('.copy-button');
                        const originalText = button.innerHTML;
                        
                        // è¤‡è£½æˆåŠŸå¾Œï¼ŒçŸ­æš«æ”¹è®ŠæŒ‰éˆ•æ–‡å­—å’Œåœ–ç¤º
                        button.innerHTML = 'âœ… å·²è¤‡è£½ï¼'; 
                        
                        // 1.5 ç§’å¾Œæ¢å¾©æŒ‰éˆ•æ–‡å­—
                        setTimeout(() => {
                            button.innerHTML = originalText;
                        }, 1500);
                    })
                    .catch(err => {
                        console.error('è¤‡è£½å¤±æ•—:', err);
                        alert('è¤‡è£½ç¨‹å¼ç¢¼å¤±æ•—ï¼Œè«‹ç¢ºèªç€è¦½å™¨æ¬Šé™æˆ–æ‰‹å‹•é¸å–å…§å®¹ã€‚');
                    });
            }
        }
    </script>
</body>
</html>